import React, { useRef, useLayoutEffect } from 'react'
import { Link } from 'react-router-dom'
import styled, { css } from '@emotion/styled'
import { breakpoint } from '../App/styles'
import { space } from 'styled-system'

export const TagList = styled.ul`
  margin: 0;
  padding: 0;
  display: ${props => (props.hide ? 'none' : 'block')};
  backface-visibility: none;
  ${props =>
    props.dark &&
    `
    li {
      color: var(--dark) !important;
      border-color: var(--dark) !important;
  `};
  ${space}
`

export const Tag = styled.li`
  list-style-type: none;
  font-size: 0.9rem;
  color: white;
  border: 1px solid white;
  border-radius: 100px;
  display: inline-block;
  margin-right: 0.5rem;
  padding: 0.05rem 0.5rem;
  overflow: hidden;
  span {
    display: inline-block;
  }
`

export const ToggleVisibility = styled.div`
  display: ${props => (props.visible ? 'none' : 'block')};
`

const ImgContainer = styled.div`
  img {
    width: 120vw;
    height: 85vh;
    object-fit: cover;
    @media (min-width: ${breakpoint}px) {
      width: 30rem;
      height: 30rem;
    }
  }
`

const makePreloadedImg = (Container = 'div') => ({ id, ...rest }) => {
  const containerRef = useRef(null)
  useLayoutEffect(() => {
    const el = document.getElementById(id)
    const elParent = el.parentNode
    Object.keys(rest).forEach(key => {
      el.setAttribute(key, rest[key])
    })
    containerRef.current.appendChild(el)
    const elCopy = el.cloneNode()

    elParent.appendChild(elCopy)
  }, [id])
  return <Container ref={containerRef}></Container>
}

export const PreloadedImg = makePreloadedImg(ImgContainer)

export const VisibleOnDesktop = styled.div`
  display: none;
  @media (min-width: ${breakpoint}px) {
    display: block;
  }
`

const StyledHeader = styled.header`
  padding-top: 1.5rem;
  font-weight: bold;
  text-align: center;
  @media (min-width: ${breakpoint}px) {
    padding-top: 1rem;
    padding-bottom: 1rem;
    font-size: 1.5rem;
  }
  ${space}
  svg {
    height: 2rem;
    position: relative;
    top: -0.1rem;
    margin-right: 0.25rem;
    @media (min-width: ${breakpoint}px) {
      height: 3rem;
    }
  }
`

const StyledLink = styled(Link)`
  color: var(--dark);
  text-decoration: none;
  &:focus,
  &:hover {
    color: var(--dark);
    text-decoration: none;
  }
`

export const Header = props => {
  return (
    <StyledHeader {...props}>
      <StyledLink to="/">
        <svg
          enable-background="new 0 0 479.549 479.549"
          viewBox="0 0 479.549 479.549"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path d="m462.069 167.018-98.153-74.887c-11.036-8.419-25.953-9.409-38.003-2.52l-9.314 5.324c-6.529-4.84-13.543-9.091-20.978-12.657-35.433-16.992-76.075-16.992-111.506 0-8.187 3.926-15.866 8.679-22.945 14.14l-6.369-4.369c-12.301-8.439-28.535-8.03-40.395 1.02l-96.925 73.95c-18.636 14.218-23.025 40.618-9.994 60.102l86.815 129.802c1.682 2.514 4.498 3.997 7.479 3.997.329 0 .659-.018.99-.054 3.337-.369 6.192-2.564 7.405-5.695l16.07-41.489c1.971 1.612 4.148 2.996 6.505 4.09 9.711 4.509 17.098 12.525 20.8 22.573l7.063 19.171c3.483 9.453 10.533 16.692 19.217 20.54 3.14 17.022 18.083 29.961 36 29.961h48.074c17.926 0 32.874-12.952 36.004-29.987 8.677-3.85 15.732-11.066 19.213-20.514l7.063-19.171c3.702-10.047 11.088-18.063 20.8-22.573 2.301-1.068 4.432-2.409 6.365-3.971l16.024 41.37c1.213 3.13 4.067 5.326 7.405 5.695.331.037.661.054.99.054 2.981 0 5.798-1.482 7.479-3.997l86.815-129.802c13.031-19.484 8.641-45.884-9.994-60.103zm-362.428 165.511-77.193-115.416c-7.759-11.601-5.145-27.319 5.95-35.784l73.127-55.793c1.65 1.888 4.069 3.086 6.773 3.086 4.971 0 9-4.029 9-9v-1.8c0-1.323-.293-2.575-.805-3.706l8.829-6.737c5.666-4.322 13.419-4.517 19.295-.487l2.733 1.875c-14.526 14.977-25.383 33.413-31.311 53.853-10.016 34.541-11.873 71.493-5.368 106.862l4.311 23.44-4.18 10.792c-1.523-1.181-3.429-1.891-5.505-1.891-4.971 0-9 4.029-9 9v1.8c0 4.498 3.303 8.214 7.613 8.882zm164.263 59.486h-48.074c-6.849 0-12.83-3.728-16.063-9.251l17.551-2.083c8.899-1.056 16.828-5.354 22.549-11.696 5.722 6.341 13.651 10.64 22.55 11.696l17.55 2.082c-3.233 5.524-9.214 9.252-16.063 9.252zm-18.421-59.089-1.278 2.87c-2.854.361-5.822.361-8.675 0l-1.279-2.871c-3.307-7.421-10.718-11.777-18.461-11.386-.113-.629-.169-1.265-.169-1.906 0-10.727 18.943-11.707 22.763-11.794.994-.025 1.953-.026 2.991 0 3.797.087 22.74 1.067 22.74 11.794 0 .641-.057 1.276-.169 1.906-7.752-.397-15.157 3.967-18.463 11.387zm37.628 32.084-18.573-2.204c-6.137-.728-11.348-4.537-14.031-9.851.755-.158 1.51-.312 2.255-.503 2.66-.684 4.862-2.545 5.98-5.054l3.184-7.148c.256-.574.901-.859 1.495-.661l2.723.899c3.719 1.228 7.805-.09 10.105-3.26 3.837-5.287 5.866-11.371 5.866-17.595 0-17.532-15.829-29.225-40.303-29.789-1.3-.033-2.607-.033-3.865 0-24.497.564-40.326 12.257-40.326 29.789 0 6.223 2.028 12.307 5.865 17.595 2.301 3.17 6.387 4.488 10.106 3.26l2.722-.899c.599-.196 1.24.088 1.496.661l3.184 7.147c1.118 2.508 3.32 4.37 5.979 5.054.744.191 1.5.346 2.255.503-2.682 5.314-7.893 9.123-14.03 9.851l-18.573 2.204c-7.492.887-14.575-2.906-18.056-9.388h.531c4.971 0 9-4.029 9-9s-4.029-9-9-9h-1.8c-.834 0-1.637.122-2.403.334.091-5.432 1.228-10.843 3.421-15.958l22.636-52.817c5.353-12.489 16.467-21.705 29.731-24.652 6.009-1.336 12.359-1.336 18.369 0 13.264 2.947 24.378 12.163 29.73 24.652l17.34 40.46c-4.795.199-8.623 4.137-8.623 8.981 0 4.971 4.029 9 9 9h1.8c1.719 0 3.32-.491 4.686-1.327 2.703 8.807 2.471 18.229-.747 26.978l-.007.019c-2.91 7.891-10.773 12.707-19.122 11.719zm56.293-63.566c-8.069 3.746-15.019 9.173-20.499 15.86-.304-.802-.603-1.605-.942-2.397l-22.636-52.817c-7.628-17.798-23.467-30.932-42.37-35.133-8.563-1.903-17.616-1.903-26.179 0-18.903 4.2-34.743 17.334-42.371 35.133l-22.636 52.817c-.337.787-.652 1.581-.955 2.377-5.477-6.679-12.424-12.098-20.486-15.841-2.805-1.302-5.014-3.571-6.262-6.334.077.001.153.012.23.012 7.622 0 13.822-6.2 13.822-13.822v-5.357c0-7.621-6.2-13.821-13.822-13.821-2.291 0-4.448.569-6.352 1.56-5.457-31.858-3.62-65.007 5.382-96.049 5.918-20.408 17.545-38.495 33.194-52.301 1.65 1.89 4.07 3.09 6.776 3.09 4.971 0 9-4.029 9-9v-1.8c0-1.235-.25-2.412-.7-3.483 3.316-2.048 6.753-3.93 10.3-5.631 30.484-14.62 65.453-14.62 95.938 0 28.438 13.639 49.786 38.834 58.57 69.125 9.242 31.867 10.955 65.96 4.953 98.592l-4.771 25.945c-.748 4.067-3.434 7.534-7.184 9.275zm117.697-84.331-40.223 60.14-1.109-1.65c-4.925-7.33-14.896-9.287-22.226-4.361-7.33 4.925-9.286 14.896-4.361 22.226l4.348 6.47c1.32 1.964 3.03 3.564 4.996 4.754l-18.618 27.836-15.216-39.283 4.371-23.765c6.505-35.37 4.648-72.322-5.368-106.862-6.108-21.061-17.445-39.999-32.642-55.213l3.793-2.168c5.757-3.29 12.882-2.817 18.152 1.204l47.124 35.954c-1.268-.384-2.61-.596-4.002-.596-7.621 0-13.821 6.2-13.821 13.822v5.357c0 7.126 5.422 13.008 12.357 13.742v4.901c0 7.621 6.2 13.821 13.821 13.821s13.821-6.2 13.821-13.821v-5.357c0-7.126-5.422-13.008-12.357-13.742v-4.901c0-2.713-.797-5.239-2.153-7.377l43.362 33.084c11.096 8.466 13.71 24.185 5.951 35.785z" />
          <path d="m334.62 203.745c-4.34-6.972-11.135-11.836-19.133-13.696-7.997-1.859-16.242-.495-23.214 3.844l-9.497 5.912c-2.447 1.523-3.901 4.03-4.185 6.69-.003.023-1.651 16.686-1.651 16.686-.487 4.947 3.128 9.352 8.074 9.839.3.03.598.044.893.044 4.078 0 7.625-2.764 8.672-6.656 3.517 2.016 7.349 3.53 11.409 4.475 3.183.74 6.393 1.106 9.581 1.106 7.74 0 15.346-2.158 22.08-6.35 4.22-2.627 5.511-8.177 2.884-12.397zm-24.555 9.605c-3.171-.738-6.1-2.083-8.657-3.942l.377-.235c2.889-1.799 6.306-2.366 9.622-1.593 3.315.771 6.132 2.788 7.931 5.677l.235.377c-3.115.541-6.335.453-9.508-.284z" />
          <path d="m200.968 205.406c-.541-2.325-1.983-4.339-4.01-5.601l-9.497-5.912c-6.972-4.34-15.217-5.707-23.214-3.844-7.999 1.86-14.793 6.725-19.134 13.696l-5.912 9.497c-2.627 4.22-1.335 9.77 2.884 12.397 6.88 4.283 14.528 6.323 22.091 6.323 7.336 0 14.582-1.939 20.968-5.599 1.031 3.915 4.589 6.7 8.683 6.7.295 0 .593-.014.893-.044 4.946-.487 8.562-4.892 8.074-9.839.002 0-1.742-17.414-1.826-17.774zm-40.8 8.216.228-.365c1.799-2.89 4.616-4.906 7.931-5.677 3.315-.772 6.732-.206 9.623 1.594l.366.228c-5.22 3.781-11.797 5.313-18.148 4.22z" />
          <path d="m301.502 162.527h.003c.875 4.055 4.477 7.095 8.794 7.095 4.971 0 9-4.029 9-9v-1.8c0-2.595-1.105-4.927-2.862-6.569.689-1.785 1.082-3.716 1.082-5.741v-7.795c0-8.832-7.185-16.016-16.016-16.016s-16.016 7.185-16.016 16.016v7.795c-.001 8.831 7.184 16.015 16.015 16.015z" />
          <path d="m201.298 150.622c-7.621 0-13.821 6.2-13.821 13.821v5.357c0 7.622 6.2 13.822 13.821 13.822s13.821-6.2 13.821-13.822v-5.357c.001-7.621-6.199-13.821-13.821-13.821z" />
          <path d="m67.978 211.837c.838-1.782 1.321-3.762 1.321-5.858v-5.357c0-7.622-6.2-13.822-13.821-13.822s-13.821 6.2-13.821 13.822v1.958c-6.874 5.046-8.625 14.683-3.825 21.826l4.348 6.47c2.386 3.551 6.012 5.96 10.21 6.784 1.039.204 2.081.305 3.116.305 3.149 0 6.228-.932 8.9-2.728 7.33-4.925 9.286-14.896 4.36-22.226z" />
          <path d="m218.099 264.622h-1.8c-4.971 0-9 4.029-9 9s4.029 9 9 9h1.8c4.971 0 9-4.029 9-9s-4.03-9-9-9z" />
          <path d="m99.198 186.522v-1.8c0-4.971-4.029-9-9-9s-9 4.029-9 9v1.8c0 4.971 4.029 9 9 9s9-4.029 9-9z" />
          <path d="m383.298 214.622c-4.971 0-9 4.029-9 9v1.8c0 4.971 4.029 9 9 9s9-4.029 9-9v-1.8c0-4.971-4.029-9-9-9z" />
        </svg>
        - ify
      </StyledLink>
    </StyledHeader>
  )
}
